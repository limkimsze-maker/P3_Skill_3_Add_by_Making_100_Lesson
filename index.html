<!doctype html>
<html lang="en">
<head>
  <!-- /standard (Kim Sze) -->
  <link rel="icon" href="./kimsze_sharp16.ico?v=20260111a" sizes="any">
  <link rel="shortcut icon" href="./kimsze_sharp16.ico?v=20260111a">

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Method 2 ‚Äî Make 100 First (91‚Äì99) ‚Äî Step-by-step Practice</title>

  <!-- ‚úÖ Always-Clear on Load (Default Build Contract) -->
  <script>
  (function(){
    const ACTIVITY_ID = "https://limkimsze-maker.github.io/Make100_First_Method2/";
    try{
      const toDelete = [];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(!k) continue;
        if(k === ACTIVITY_ID) toDelete.push(k);
        if(k.startsWith(ACTIVITY_ID+"::")) toDelete.push(k);
        if(k.startsWith("sls_scope::"+ACTIVITY_ID)) toDelete.push(k);
        if(k.startsWith("UFCO-firstSubmit::"+ACTIVITY_ID)) toDelete.push(k);
        if(k.startsWith("sls_unlike_payload::"+ACTIVITY_ID)) toDelete.push(k);
        if(k.startsWith("sls_unlike_payload::"+ACTIVITY_ID+"::")) toDelete.push(k);
        if(k.startsWith("UFCO-")) toDelete.push(k);
      }
      toDelete.forEach(k=>{ try{ localStorage.removeItem(k); }catch(e){} });

      try{
        sessionStorage.removeItem("UFCO-audio-unlocked");
        sessionStorage.removeItem("UFCO-complete");
      }catch(e){}

      try{
        const bc = new BroadcastChannel("xapi-state");
        bc.postMessage({type:"clear", activityId: ACTIVITY_ID, ts: Date.now()});
        bc.close();
      }catch(e){}
    }catch(e){}
  })();
  </script>

  <style>
    :root{
      --bgA:#f6fbff; --bgB:#fff7ed;
      --card:rgba(255,255,255,.92);
      --ink:#0f172a; --muted:#64748b;
      --line:#e2e8f0;
      --good:#16a34a; --bad:#dc2626; --warn:#f59e0b;
      --accent:#0ea5e9; --accent2:#a855f7;
      --orange:#f59e0b; --blue:#0ea5e9;
      --shadow:0 18px 44px rgba(2,6,23,.12);
      --radius:18px;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}

    html, body{
      width:100%;
      height:100%;
      margin:0;
      overflow:hidden;
      position:fixed;
      overscroll-behavior:none;
      touch-action:manipulation;
      font-family:var(--font);
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 15% 5%, rgba(14,165,233,.18), transparent 60%),
        radial-gradient(1200px 700px at 85% 10%, rgba(168,85,247,.14), transparent 60%),
        radial-gradient(900px 500px at 50% 90%, rgba(245,158,11,.10), transparent 62%),
        linear-gradient(180deg, var(--bgA), var(--bgB));
    }
    body:before{
      content:"";
      position:fixed; inset:0;
      background: repeating-linear-gradient(45deg,
        rgba(15,23,42,.03) 0 8px,
        rgba(15,23,42,0) 8px 16px);
      pointer-events:none;
      mix-blend-mode:multiply;
      opacity:.28;
    }

    /* ‚úÖ Bottom-center Main Menu (doesn't block anything except the button) */
    .mainMenuDock{
      position:fixed;
      left:0; right:0;
      bottom:10px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index:99999;
    }
    .mainMenuDock .menuBtn{
      pointer-events:auto;
      appearance:none;
      border:1px solid rgba(15,23,42,.14);
      background: rgba(255,255,255,.86);
      border-radius:999px;
      padding: 10px 14px;
      font-weight:950;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(2,6,23,.14);
      backdrop-filter: blur(10px);
      display:inline-flex;
      align-items:center;
      gap:10px;
      white-space:nowrap;
      transition: transform .06s ease, box-shadow .18s ease;
    }
    .mainMenuDock .menuBtn:hover{ transform: translateY(-1px); box-shadow: 0 14px 24px rgba(2,6,23,.18); }
    .mainMenuDock .menuBtn:active{ transform: translateY(0px); }

    /* Fit-to-viewport wrapper */
    .viewport{
      position:fixed; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .stageWrap{
      position:relative;
      width: 920px;
      height: 560px;
      overflow:hidden;
    }
    .stage{
      width: 920px;
      height: 560px;
      transform-origin: top left;
      will-change: transform;
      position:absolute; inset:0;
      overflow:hidden;
    }

    .topbar{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      padding: 2px 8px 6px 8px;
      height: 42px;
    }
    .title{ font-weight:950; letter-spacing:.2px; line-height:1.05; font-size:17px; }
    .subtitle{ margin-top:2px; color:var(--muted); font-size:10px; line-height:1.15; }
    .badges{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:nowrap;
    }
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.86);
      box-shadow:0 10px 22px rgba(2,6,23,.08);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      display:flex;
      gap:7px;
      align-items:center;
      user-select:none;
      backdrop-filter: blur(8px);
      white-space:nowrap;
    }
    .dot{ width:10px; height:10px; border-radius:50%; background:var(--warn); box-shadow:0 0 0 4px rgba(245,158,11,.18); }
    .dot.ok{ background:var(--good); box-shadow:0 0 0 4px rgba(22,163,74,.18); }

    .panel{
      margin: 0 8px 6px 8px;
      height: calc(100% - 48px);
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:10px;
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(10px);
    }
    .panel:before{
      content:"";
      position:absolute;
      width:200px; height:200px;
      right:-80px; top:-80px;
      border-radius:56px;
      background: radial-gradient(circle at 30% 30%, rgba(14,165,233,.32), rgba(168,85,247,.16), transparent 70%);
      transform: rotate(18deg);
      pointer-events:none;
    }

    .layout{
      height:100%;
      display:grid;
      grid-template-columns: 1fr 170px;
      gap:10px;
      align-items:stretch;
      position:relative;
      z-index:1;
      min-height:0;
      overflow:hidden;
    }

    .mainCard{
      height:100%;
      background: rgba(255,255,255,.94);
      border:1px solid var(--line);
      border-radius:16px;
      padding:8px;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:8px;
      min-height:0;
    }

    .qHeader{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin:0;
    }
    .eqBig{
      display:flex;
      align-items:baseline;
      gap:8px;
      flex-wrap:nowrap;
      white-space:nowrap;
      font-weight:950;
      letter-spacing:.2px;
      font-size:22px;
    }
    .eqBig .op{ color:var(--muted); font-weight:900; }
    .hint{
      color:var(--muted);
      font-size:10px;
      line-height:1.15;
      text-align:right;
      max-width: 340px;
    }

    .mid{
      min-height:0;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:10px;
      overflow:hidden;
    }

    .leftBoard{
      border:1px solid var(--line);
      border-radius:16px;
      padding:10px;
      background:
        radial-gradient(700px 240px at 25% 40%, rgba(14,165,233,.10), transparent 60%),
        radial-gradient(700px 240px at 75% 40%, rgba(168,85,247,.10), transparent 60%),
        rgba(255,255,255,.96);
      overflow:hidden;
      display:grid;
      grid-template-rows: auto auto 1fr;
      gap:10px;
      min-height:0;
    }

    .bondRow{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:start;
      gap:10px;
      overflow:hidden;
    }
    .plusBadge{
      width:38px; height:38px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.88);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:950;
      color:var(--muted);
      box-shadow:0 8px 16px rgba(2,6,23,.08);
      user-select:none;
      margin-top:56px;
    }

    .bondBox{
      width:100%;
      height:190px;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.06);
      background: radial-gradient(520px 220px at 50% 30%, rgba(255,255,255,.95), rgba(255,255,255,.60));
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .eqStrip{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      font-weight:950;
      font-size:16px;
      padding:4px 2px;
    }
    .eqStrip .dim{ color:var(--muted); font-weight:900; }
    .eqStrip .blue{ color: var(--blue); }

    .finalPill{
      margin-top:auto;
      border-radius:16px;
      padding:12px 12px;
      background: rgba(14,165,233,.08);
      border:1px solid rgba(14,165,233,.18);
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      font-weight:950;
      font-size:22px;
      letter-spacing:.2px;
      overflow:hidden;
    }

    .stepsCol{
      display:grid;
      grid-template-rows: 1fr 1fr;
      gap:10px;
      overflow:hidden;
      min-height:0;
    }
    .stepCard{
      border-radius:16px;
      background:rgba(255,255,255,.96);
      border:2px solid var(--line);
      padding:10px 10px;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto auto 1fr;
      gap:6px;
      min-height:0;
    }
    .stepCard.orange{ border-color: rgba(245,158,11,.75); }
    .stepCard.blue{ border-color: rgba(14,165,233,.75); }

    .stepTitle{
      display:flex;
      gap:8px;
      align-items:baseline;
      font-weight:950;
      letter-spacing:.2px;
    }
    .stepTitle .label{
      font-size:18px;
      text-decoration: underline;
    }
    .stepTitle.orange .label{ color: var(--orange); }
    .stepTitle.blue .label{ color: var(--blue); }

    .stepDesc{
      font-weight:900;
      font-size:14px;
      color:var(--ink);
    }
    .stepEq{
      font-weight:950;
      font-size:18px;
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .stepEq .dim{ color:var(--muted); font-weight:900; }
    .bubble{
      margin-top:6px;
      background: rgba(34,197,94,.18);
      border:1px solid rgba(34,197,94,.28);
      padding:10px 10px;
      border-radius:16px;
      color:#14532d;
      font-weight:900;
      line-height:1.2;
      font-size:12px;
      box-shadow:0 10px 18px rgba(2,6,23,.06);
      position:relative;
      overflow:hidden;
    }
    .bubble:before{
      content:"";
      position:absolute;
      left:14px; bottom:-8px;
      width:14px; height:14px;
      background: rgba(34,197,94,.18);
      border-left:1px solid rgba(34,197,94,.28);
      border-bottom:1px solid rgba(34,197,94,.28);
      transform: rotate(45deg);
    }

    input.blank{
      width:74px;
      height:30px;
      border-radius:12px;
      border:2px solid var(--line);
      padding:0 8px;
      font-size:16px;
      font-weight:950;
      text-align:center;
      outline:none;
      background:#fff;
      line-height:30px;
    }
    input.blank.tiny{ width:64px; }
    input.blank:focus{
      border-color: rgba(14,165,233,.75);
      box-shadow:0 0 0 4px rgba(14,165,233,.16);
    }
    .okField{ border-color: rgba(22,163,74,.92)!important; box-shadow:0 0 0 4px rgba(22,163,74,.14)!important; }
    .badField{ border-color: rgba(220,38,38,.92)!important; box-shadow:0 0 0 4px rgba(220,38,38,.12)!important; }

    #finalText{
      width:92px;
      height:34px;
      font-size:20px;
      border-radius:14px;
      line-height:34px;
    }

    button{
      border:1px solid var(--line);
      background:#fff;
      border-radius:13px;
      font-weight:950;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(2,6,23,.08);
      white-space:nowrap;
      touch-action:manipulation;
      user-select:none;
    }
    button.primary{
      background:linear-gradient(180deg, rgba(14,165,233,.96), rgba(14,165,233,.82));
      border-color: rgba(14,165,233,.6);
      color:#fff;
    }
    button.good{
      background:linear-gradient(180deg, rgba(22,163,74,.96), rgba(22,163,74,.82));
      border-color: rgba(22,163,74,.6);
      color:#fff;
    }
    button.ghost{ background:rgba(255,255,255,.78); }
    button.warn{
      background:linear-gradient(180deg, rgba(245,158,11,.96), rgba(245,158,11,.82));
      border-color: rgba(245,158,11,.6);
      color:#fff;
    }

    .rail{
      height:100%;
      background: rgba(255,255,255,.94);
      border:1px solid var(--line);
      border-radius:16px;
      padding:9px;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:8px;
      min-height:0;
    }
    .railTitle{
      font-weight:950;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .railBtns{
      display:grid;
      gap:8px;
      align-content:start;
    }
    .railBtns button{
      width:100%;
      padding:10px 10px;
      font-size:12px;
      border-radius:14px;
    }
    .railFooter{
      display:grid;
      gap:8px;
    }
    .feedback{
      border:1px solid var(--line);
      border-radius:14px;
      padding:8px 9px;
      background: rgba(255,255,255,.88);
      color:var(--muted);
      font-size:10.8px;
      line-height:1.25;
      height:92px;
      overflow:hidden;
    }
    .feedback strong{ color:var(--ink); }
    .creditInline{
      margin-top:4px;
      font-size:11px;
      color:var(--muted);
      text-align:center;
      user-select:none;
    }

    .confetti{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 9999;
    }
    .confetti i{
      position:absolute; top:-12px;
      width:10px; height:14px;
      border-radius:3px;
      opacity:.95;
      animation: fall 1100ms linear forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(260deg); opacity:1; }
    }

    #panel.smallMode .layout{ grid-template-columns: 1fr; }
    #panel.smallMode .hint{ display:none; }
    #panel.smallMode .mid{ grid-template-columns: 1fr; }
    #panel.smallMode .stepsCol{ grid-template-rows: auto auto; }
    #panel.smallMode .rail{ grid-template-rows: auto auto; height:auto; }
    #panel.smallMode .railBtns{ grid-template-columns: repeat(3, 1fr); gap:8px; }
    #panel.smallMode .railFooter{ grid-template-columns: 1fr 1fr; align-items:stretch; }
    #panel.smallMode .bondBox{ height:175px; }
    #panel.smallMode .plusBadge{ margin-top:44px; }

    #xapiBase{ display:none!important; }
  </style>
</head>

<body>
  <div class="viewport">
    <div class="stageWrap" id="stageWrap">
      <div class="stage" id="stage">
        <div class="topbar">
          <div>
            <div class="title">Addition Technique 3: Make 100</div>
            <div class="subtitle">Best when the first number is 91‚Äì99. Make 100 first, then add the remainder.</div>
          </div>
          <div class="badges">
            <div class="pill"><span class="dot" id="statusDot"></span><span id="statusText">Not checked</span></div>
            <div class="pill"><span style="font-weight:950">Score</span> <span id="scorePill">0</span></div>
          </div>
        </div>

        <div class="panel" id="panel">
          <div class="layout">

            <!-- MAIN -->
            <div class="mainCard">
              <div class="qHeader">
                <div class="eqBig" aria-label="question equation">
                  <span id="A">97</span>
                  <span class="op">+</span>
                  <span id="B">47</span>
                </div>
                <div class="hint" id="hintText">Tip: Split the second number into ‚Äúto make 100‚Äù and ‚Äúremainder‚Äù.</div>
              </div>

              <div class="mid">
                <!-- LEFT: bond + equation + final -->
                <div class="leftBoard">
                  <div class="bondRow">
                    <div class="bondBox" aria-label="first number">
                      <svg viewBox="0 0 320 190" width="100%" height="190" role="img" aria-label="First number node">
                        <defs>
                          <radialGradient id="gNodeA" cx="30%" cy="30%">
                            <stop offset="0" stop-color="#ffffff"/>
                            <stop offset="1" stop-color="rgba(240,253,250,0.94)"/>
                          </radialGradient>
                          <filter id="shadowA" x="-30%" y="-30%" width="160%" height="160%">
                            <feDropShadow dx="0" dy="7" stdDeviation="9" flood-color="rgba(2,6,23,0.16)"/>
                          </filter>
                        </defs>
                        <g filter="url(#shadowA)">
                          <circle cx="160" cy="64" r="44" fill="url(#gNodeA)" stroke="rgba(34,197,94,0.55)" stroke-width="8"/>
                          <text x="160" y="72" text-anchor="middle" font-size="26" font-weight="950" fill="#0f172a" id="Atxt">97</text>
                        </g>
                        <text x="160" y="148" text-anchor="middle" font-size="12" font-weight="900" fill="#64748b">first number (91‚Äì99)</text>
                      </svg>
                    </div>

                    <div class="plusBadge">+</div>

                    <div class="bondBox" aria-label="number bond for second number">
                      <svg viewBox="0 0 320 190" width="100%" height="190" role="img" aria-label="Number bond B">
                        <defs>
                          <linearGradient id="gLineB" x1="0" x2="1">
                            <stop offset="0" stop-color="rgba(34,197,94,.95)"/>
                            <stop offset="1" stop-color="rgba(16,185,129,.92)"/>
                          </linearGradient>
                          <radialGradient id="gNodeB" cx="30%" cy="30%">
                            <stop offset="0" stop-color="#ffffff"/>
                            <stop offset="1" stop-color="rgba(240,253,250,0.94)"/>
                          </radialGradient>
                          <filter id="shadowB" x="-30%" y="-30%" width="160%" height="160%">
                            <feDropShadow dx="0" dy="7" stdDeviation="9" flood-color="rgba(2,6,23,0.16)"/>
                          </filter>
                        </defs>

                        <path d="M160 48 C120 76, 95 110, 86 142" fill="none" stroke="url(#gLineB)" stroke-width="9" stroke-linecap="round" opacity="0.9"/>
                        <path d="M160 48 C200 76, 225 110, 234 142" fill="none" stroke="url(#gLineB)" stroke-width="9" stroke-linecap="round" opacity="0.9"/>

                        <g filter="url(#shadowB)">
                          <circle cx="160" cy="48" r="36" fill="url(#gNodeB)" stroke="rgba(34,197,94,0.55)" stroke-width="7"/>
                          <text x="160" y="56" text-anchor="middle" font-size="22" font-weight="950" fill="#0f172a" id="Btxt">47</text>
                        </g>

                        <g filter="url(#shadowB)">
                          <circle cx="86" cy="142" r="40" fill="url(#gNodeB)" stroke="rgba(34,197,94,0.55)" stroke-width="7"/>
                          <text x="86" y="116" text-anchor="middle" font-size="11" font-weight="900" fill="#64748b">to 100</text>
                          <foreignObject x="43" y="128" width="86" height="52">
                            <div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;justify-content:center;">
                              <input class="blank tiny" id="to100" inputmode="numeric" autocomplete="off" aria-label="part to make 100"/>
                            </div>
                          </foreignObject>
                        </g>

                        <g filter="url(#shadowB)">
                          <circle cx="234" cy="142" r="40" fill="url(#gNodeB)" stroke="rgba(34,197,94,0.55)" stroke-width="7"/>
                          <text x="234" y="116" text-anchor="middle" font-size="11" font-weight="900" fill="#64748b">remainder</text>
                          <foreignObject x="191" y="128" width="86" height="52">
                            <div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;justify-content:center;">
                              <input class="blank tiny" id="remain" inputmode="numeric" autocomplete="off" aria-label="remainder part"/>
                            </div>
                          </foreignObject>
                        </g>
                      </svg>
                    </div>
                  </div>

                  <div class="eqStrip" aria-label="equation chain">
                    <span id="Aeq">97</span>
                    <span class="dim">+</span>
                    <span id="Beq">47</span>
                    <span class="dim">=</span>
                    <span class="dim">100</span>
                    <span class="dim">+</span>
                    <input class="blank tiny" id="eq_rem" inputmode="numeric" autocomplete="off" aria-label="remainder in equation"/>
                    <span class="dim">=</span>
                    <input class="blank tiny" id="eq_final" inputmode="numeric" autocomplete="off" aria-label="final answer"/>
                  </div>

                  <div class="finalPill" aria-label="final equation">
                    <span id="Afinal">97</span>
                    <span class="op" style="color:var(--muted);font-weight:900;">+</span>
                    <span id="Bfinal">47</span>
                    <span class="op" style="color:var(--muted);font-weight:900;">=</span>
                    <input class="blank" id="finalText" inputmode="numeric" autocomplete="off" aria-label="final answer (bottom)"/>
                  </div>
                </div>

                <div class="stepsCol" aria-label="step cards">
                  <div class="stepCard orange">
                    <div class="stepTitle orange"><span class="label">STEP 1</span></div>
                    <div class="stepDesc">Make 100.</div>
                    <div class="stepEq">
                      <span id="Astep1">97</span>
                      <span class="dim">+</span>
                      <input class="blank tiny" id="s1_add" inputmode="numeric" autocomplete="off" aria-label="add to make 100"/>
                      <span class="dim">=</span>
                      <input class="blank tiny" id="s1_ans" inputmode="numeric" autocomplete="off" aria-label="step 1 answer"/>
                    </div>
                    <div class="bubble" id="bubbleText">Add ___ to 97 to make 100 first.</div>
                  </div>

                  <div class="stepCard blue">
                    <div class="stepTitle blue"><span class="label">STEP 2</span></div>
                    <div class="stepDesc">Add 100 to the remainder.</div>
                    <div class="stepEq">
                      <span class="dim">100</span>
                      <span class="dim">+</span>
                      <input class="blank tiny" id="s2_rem" inputmode="numeric" autocomplete="off" aria-label="remainder"/>
                      <span class="dim">=</span>
                      <input class="blank tiny" id="s2_ans" inputmode="numeric" autocomplete="off" aria-label="final answer"/>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="rail" aria-label="controls">
              <div class="railTitle">
                <span>Controls</span>
                <span style="color:var(--muted); font-size:11px;">Step-by-step</span>
              </div>

              <div class="railBtns">
                <button class="primary" id="btnCheck" type="button">Check</button>
                <button class="warn" id="btnNext" type="button">Next ‚ñ∂</button>
                <button class="ghost" id="btnClear" type="button">Clear</button>
                <button class="ghost" id="btnShowAll" type="button">Show all</button>
                <button class="good" id="btnNew" type="button">New</button>
              </div>

              <div class="railFooter">
                <div class="feedback" id="fb">
                  <strong>Goal:</strong> Split the second number into ‚Äúto make 100‚Äù and ‚Äúremainder‚Äù, then add.
                </div>
                <div class="creditInline">Designed by Lim Kim Sze ¬© 2026</div>
              </div>
            </div>

          </div>

          <div class="confetti" id="confetti"></div>
        </div>

        <div id="xapiBase">
          <script src="xapiwrapper.min.js"></script>
          <script src="index.js"></script>
          <div><label>score</label><input id="score-input" value="0"></div>
          <div><label>feedback</label><input id="feedback-input" value="Well done!"></div>
          <button id="sendBtn" type="button">Send/Save</button>
        </div>

      </div>
    </div>
  </div>

  <!-- ‚úÖ Bottom-center Main Menu button -->
  <div class="mainMenuDock">
    <button class="menuBtn" id="btnMainMenu" type="button" title="Back to Main Menu">üè† Main Menu</button>
  </div>

  <script>
    let audioCtx = null;
    function ensureAudio(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      return audioCtx;
    }
    function beep(freq=660, ms=120, type="sine", gainVal=0.06){
      const ctx = ensureAudio();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = type; o.frequency.value = freq; g.gain.value = gainVal;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      setTimeout(()=>{ try{o.stop();}catch(e){} }, ms);
    }
    function sfxCorrect(){ try{ beep(740,110,"triangle",0.07); setTimeout(()=>beep(990,130,"triangle",0.06),120);}catch(e){} }
    function sfxWrong(){ try{ beep(220,180,"sawtooth",0.05);}catch(e){} }
    function sfxClock(){ try{ beep(520,70,"square",0.03);}catch(e){} }
  </script>

  <script>
    const ACTIVITY_ID = "https://limkimsze-maker.github.io/Make100_First_Method2/";
    const MAIN_MENU_URL = "https://limkimsze-maker.github.io/P3_Mental_Sum_Challenge/";
    const $ = (id)=>document.getElementById(id);

    const state = { A:97, B:47, to100:3, remain:44, final:144 };

    const fieldIds = ["to100","remain","eq_rem","eq_final","s1_add","s1_ans","s2_rem","s2_ans","finalText"];

    const revealPlan = [
      { id:"to100",  val:()=>state.to100, msg:()=>`Split ${state.B}: part to make 100.` },
      { id:"remain", val:()=>state.remain, msg:()=>`Remaining part after making 100.` },
      { id:"s1_add", val:()=>state.to100, msg:()=>`Step 1: add ${state.to100} to ${state.A}.` },
      { id:"s1_ans", val:()=>100,        msg:()=>`${state.A} + ${state.to100} = 100.` },
      { id:"s2_rem", val:()=>state.remain, msg:()=>`Step 2: add 100 to the remainder.` },
      { id:"s2_ans", val:()=>state.final,  msg:()=>`100 + ${state.remain} = ${state.final}.` },
      { id:"eq_rem",   val:()=>state.remain, msg:()=>`Equation: 100 + remainder.` },
      { id:"eq_final", val:()=>state.final,  msg:()=>`Final answer.` },
      { id:"finalText", val:()=>state.final, msg:()=>`Bottom answer: ${state.A} + ${state.B} = ${state.final}.` },
    ];
    let nextIndex = 0;

    function lockScroll(){
      try{
        document.addEventListener("wheel", (e)=>{ e.preventDefault(); }, {passive:false});
        document.addEventListener("touchmove", (e)=>{
          const t = e.target;
          if(t && (t.tagName==="INPUT" || t.tagName==="BUTTON")) return;
          e.preventDefault();
        }, {passive:false});
      }catch(e){}
    }

    function scaleStage(){
      const stage = $("stage");
      const wrap  = $("stageWrap");
      const panel = $("panel");

      const vv = window.visualViewport;
      const vw = (vv ? vv.width : window.innerWidth);
      const vh = (vv ? vv.height : window.innerHeight);

      const designW = 920, designH = 560;
      const margin = 10;

      const scale = Math.min((vw - margin*2)/designW, (vh - margin*2)/designH);
      const s = Math.max(0.24, scale);

      wrap.style.width  = (designW * s) + "px";
      wrap.style.height = (designH * s) + "px";
      stage.style.transform = `scale(${s})`;

      const small = (vw < 860) || (s < 0.78);
      panel.classList.toggle("smallMode", small);
    }
    window.addEventListener("resize", scaleStage);
    if(window.visualViewport){
      window.visualViewport.addEventListener("resize", scaleStage);
      window.visualViewport.addEventListener("scroll", scaleStage);
    }

    function clampInt(v){
      if(v === "" || v == null) return null;
      const n = parseInt(String(v).replace(/[^\d\-]/g,""),10);
      return Number.isFinite(n) ? n : null;
    }

    function setStatus(ok, msg){
      $("statusDot").classList.toggle("ok", !!ok);
      $("statusText").textContent = msg;
    }

    function resetFieldStyles(){
      fieldIds.forEach(id=> $(id).classList.remove("okField","badField"));
    }

    function mark(elId, ok){
      const el = $(elId);
      el.classList.add(ok ? "okField" : "badField");
      return ok ? 1 : 0;
    }

    function setScore(score, feedback){
      $("scorePill").textContent = String(score);
      const scoreInput = $("score-input");
      const fbInput = $("feedback-input");
      if(scoreInput) scoreInput.value = String(score);
      if(fbInput) fbInput.value = String(feedback || "Well done!");
      try{
        if(typeof storeState === "function"){
          storeState({ score, feedback: String(feedback || "Well done!"), activityId: ACTIVITY_ID, ts: Date.now() });
        }
      }catch(e){}
    }

    function showConfetti(){
      const host = $("confetti");
      host.innerHTML = "";
      for(let i=0;i<42;i++){
        const el = document.createElement("i");
        el.style.left = (Math.random()*100) + "%";
        el.style.animationDuration = (900 + Math.random()*500) + "ms";
        el.style.background = (Math.random() < .5) ? "rgba(14,165,233,.95)" : "rgba(168,85,247,.90)";
        el.style.opacity = (0.75 + Math.random()*0.25).toFixed(2);
        host.appendChild(el);
      }
      setTimeout(()=>{ host.innerHTML=""; }, 1350);
    }

    function updateTexts(){
      $("A").textContent = state.A;
      $("B").textContent = state.B;
      $("Aeq").textContent = state.A;
      $("Beq").textContent = state.B;
      $("Afinal").textContent = state.A;
      $("Bfinal").textContent = state.B;

      $("Atxt").textContent = state.A;
      $("Btxt").textContent = state.B;

      $("Astep1").textContent = state.A;
      $("bubbleText").textContent = `Add ${state.to100} to ${state.A} to make 100 first.`;
    }

    function clearBlanks(){
      fieldIds.forEach(id=> $(id).value = "");
      resetFieldStyles();
      setStatus(false, "Cleared");
      $("fb").innerHTML = "<strong>Cleared.</strong> Fill in the blanks again.";
      setScore(0, "Well done!");
      nextIndex = 0;
      if(sessionStorage.getItem("UFCO-audio-unlocked")==="1") sfxClock();
    }

    function showAllAnswers(){
      $("to100").value = state.to100;
      $("remain").value = state.remain;

      $("s1_add").value = state.to100;
      $("s1_ans").value = 100;

      $("s2_rem").value = state.remain;
      $("s2_ans").value = state.final;

      $("eq_rem").value = state.remain;
      $("eq_final").value = state.final;

      $("finalText").value = state.final;

      resetFieldStyles();
      fieldIds.forEach(id=> $(id).classList.add("okField"));

      $("fb").innerHTML =
        `<strong>All shown:</strong> ${state.A}+${state.to100}=100, remainder ${state.remain}, so 100+${state.remain}=${state.final}.`;
      setStatus(false, "All answers shown");
      nextIndex = revealPlan.length;
      if(sessionStorage.getItem("UFCO-audio-unlocked")==="1") sfxClock();
    }

    function revealNext(){
      if(nextIndex >= revealPlan.length){
        setStatus(true, "All steps shown");
        $("fb").innerHTML = "<strong>All shown.</strong> Press Clear to try again, or New for a new question.";
        if(sessionStorage.getItem("UFCO-audio-unlocked")==="1") sfxClock();
        return;
      }
      const step = revealPlan[nextIndex];
      const el = $(step.id);
      el.value = String(step.val());
      el.classList.remove("badField");
      el.classList.add("okField");
      $("fb").innerHTML = `<strong>Next:</strong> ${step.msg()}`;
      setStatus(false, `Showing ${nextIndex+1}/${revealPlan.length}`);
      nextIndex++;
      if(sessionStorage.getItem("UFCO-audio-unlocked")==="1") sfxClock();
    }

    function setProblem(A,B){
      state.A = A;
      state.B = B;

      state.to100 = 100 - A;
      state.remain = B - state.to100;
      state.final = 100 + state.remain;

      updateTexts();
      clearBlanks();
      setStatus(false, "New question");
      $("fb").innerHTML = "<strong>Goal:</strong> Make 100 first, then add the remainder.";
    }

    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    function newQuestion(){
      const A = randInt(91, 99);
      const to100 = 100 - A;
      const minB = to100 + 10;
      const B = randInt(minB, 99);
      setProblem(A,B);
    }

    function checkAll(){
      resetFieldStyles();

      const to100 = clampInt($("to100").value);
      const remain = clampInt($("remain").value);

      const s1_add = clampInt($("s1_add").value);
      const s1_ans = clampInt($("s1_ans").value);

      const s2_rem = clampInt($("s2_rem").value);
      const s2_ans = clampInt($("s2_ans").value);

      const eq_rem = clampInt($("eq_rem").value);
      const eq_final = clampInt($("eq_final").value);

      const finalText = clampInt($("finalText").value);

      let okCount = 0;
      const total = fieldIds.length;

      okCount += mark("to100", to100 === state.to100);
      okCount += mark("remain", remain === state.remain);

      okCount += mark("s1_add", s1_add === state.to100);
      okCount += mark("s1_ans", s1_ans === 100);

      okCount += mark("s2_rem", s2_rem === state.remain);
      okCount += mark("s2_ans", s2_ans === state.final);

      okCount += mark("eq_rem", eq_rem === state.remain);
      okCount += mark("eq_final", eq_final === state.final);

      okCount += mark("finalText", finalText === state.final);

      if(okCount === total){
        setStatus(true, "‚úÖ All correct!");
        $("fb").innerHTML = "<strong>Correct!</strong> Make 100 first, then add the remainder. üéâ";
        if(sessionStorage.getItem("UFCO-audio-unlocked")==="1") sfxCorrect();
        showConfetti();
        setScore(1, "Success");
      }else{
        setStatus(false, `Try again (${okCount}/${total} correct)`);
        $("fb").innerHTML = `<strong>Keep going.</strong> Find what to add to ${state.A} to make 100, then subtract that from ${state.B}.`;
        if(sessionStorage.getItem("UFCO-audio-unlocked")==="1") sfxWrong();
        setScore(0, "Well done!");
      }
    }

    window.addEventListener("DOMContentLoaded", ()=>{
      lockScroll();

      // ‚úÖ Main Menu button
      const btn = $("btnMainMenu");
      if(btn) btn.addEventListener("click", ()=>{ window.location.href = MAIN_MENU_URL; });

      sessionStorage.setItem("UFCO-audio-unlocked","1");
      (function(){
        let armed = false;
        const arm = () => {
          if(armed) return;
          armed = true;
          try{
            const ctx = ensureAudio();
            ctx.resume && ctx.resume().catch(()=>{});
          }catch(e){}
        };
        window.addEventListener("pointerdown", arm, { once:true, capture:true });
        window.addEventListener("keydown", arm, { once:true, capture:true });
      })();

      $("btnCheck").addEventListener("click", checkAll);
      $("btnNext").addEventListener("click", revealNext);
      $("btnClear").addEventListener("click", clearBlanks);
      $("btnShowAll").addEventListener("click", showAllAnswers);
      $("btnNew").addEventListener("click", newQuestion);

      fieldIds.forEach(id=>{
        $(id).addEventListener("keydown", (e)=>{
          if(e.key==="Enter"){ e.preventDefault(); checkAll(); }
        });
      });

      scaleStage();
      setProblem(97,47);
    });
  </script>
</body>
</html>
